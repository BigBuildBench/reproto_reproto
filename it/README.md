# reproto integration tests

Each suite typically contains the following things:

* A `structures` directory, containing the code that is expected to be generated by each suite.
* A `checks` directory, containing expected results from running checks (like [`ui`]).

Tests are all defined in [`tests.rs`].

There are the following kinds of tests:

* A _structural_ test, which builds each package and compares its output with the `expected`
  directory.
* A _project test, that builds a [language-specific project] and feeds it JSON to validate that the
  generated code is sound.
* A _check test, which runs `reproto check` on a number of specifications and compares the output
  with the `checks` directory.

Some default options are defined in [`tools/it/main.rs`].

[language-specific project]: #projects
[`ui`]: ui
[`workdir`]: workdir
[`expected`]: expected
[`tests.rs`]: tests.rs
[`tools/it/main.rs`]: /tools/it/main.rs

# Running Tests

Tests should be run from the root of the project:

```bash
make suites projects
```

A single test can be targeted with the `FILTER` parameter:

```bash
make suites projects FILTER="inner"
```

For more information, see:

```bash
make help
```

# Projects

Projects are complete projects written in the target language for reproto.

They are intended to test the complete integration of reproto, to verify that it actually works as
intended.

Each project is expected to fulfill the following protocol:

* Running `make <instance>` in the directory should generate an executable `script.sh` file.
  The default `<instance>` is called `default`.
* Running the generated `script.sh` should read JSON from stdin, line-by-line. And feed them into
  the deserialize implementation.
  * `script.sh` exiting with a non-zero exit status indicated a failure.
  * The script when run is expected to read JSON documents from stdin, and print them to stdout
    without modification.
    This assumes that the documents have been feed through internal models, therefore testing that
    the serialization is sound.

The base project available are:

* [Java](workdir/java)
* [JavaScript](workdir/js)
* [Rust](workdir/rust)
* [Python](workdir/python)
* [Python 3](workdir/python3)
* [C#](workdir/csharp)
* [Swift](workdir/swift)
* [Go](workdir/go)
